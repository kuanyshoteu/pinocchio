{% extends "base.html" %}
{% load crispy_forms_tags %}
{% load staticfiles %}
{% load ttags %}
{% block content %}
<script src="https://api-maps.yandex.ru/2.1/?apikey=e41c217e-d9c0-4663-a3b4-4dba98ca5e05&lang=ru_RU"
    type="text/javascript"></script>
<div style="display: none;" class="schoolLanding__header-gallery">
    <div class="schoolLanding__header-gallery__nav"><i id="landing__gallery-download" class="icon download"></i><i id="landing__gallery-close" class="icon close"></i></div>
    <div id="schoolLanding__header-gallery__sliderone" class="owl-carousel owl-theme">
      {% for banner in school.banners.all %}
      <div style="background: center / contain no-repeat url('{{banner.image_banner.url}}');" class="schoolLanding__header-gallery__item"></div>
      {% endfor %}
    </div>
    <div id="schoolLanding__header-gallery__slidertwo" class="owl-carousel owl-theme">
      {% for banner in school.banners.all %}
      <div style="background: center / cover no-repeat url('{{banner.image_banner.url}}');" class="schoolLanding__header-gallery__item schoolLanding__header-gallery__item-small"></div>
      {% endfor %}
    </div>
  </div>
  
    <header class="schoolLanding__header-wrapper" style="display: block;margin-top: -5px;">
    {% if school.banners.all|length %}
          {% for banner in school.banners.all %}
              {% if banner.image_banner and forloop.counter < 4 %}
                <div style="width: calc(33.333% - 6px);display: inline-block;background: url({{banner.image_banner.url}});" class="schoolLanding__header-img"></div>
              {% endif %}
          {% endfor %}
    {% else %}
          <div style="width: calc(100% - 3px);display: inline-block;background: url({% static 'images/fon1.png' %});" class="schoolLanding__header-img"></div>
    {% endif %}
  </header>
  <main class="schoolLanding__container">
    <div class="schoolLanding__content-header">
      <div class="schoolLanding__content-headerLeft">
        <div class="organization__info-top-part">
          <div class="organization__info-left-part">
            <div style="background: url({% if school.image_icon %}'{{ school.image_icon.url }}'{% else %}{% static 'images/nophoto.png' %}{% endif %}); background-position: center; background-size: contain;background-color: #fff;" class="organization__info-photo"></div>
            <div class="organization__info-main">
              <h2 class="organization__info-title">{{ school.title }}</h2>
              <p class="organization__info-subtitle">{{ school.slogan }}</p>
              <p class="organization__info-buttons">
                <span class="organization__info-buttons-call">
                  <i class="icon phone"></i>
                </span>
                {% for phone in school.phones %}{{phone}} {% if forloop.counter < school.phones|length %},{% endif %}{% endfor %}
              </p>
            </div>
          </div>
          <div class="organization__info-middle-part">
            <div class="organization__info-middle-part__wrap">
              <span class="organization__info-rating">
                <span class="organization__info-rating-avg">{{school.rating}}</span>
                    <span class="organization__info-rating-icon active">
                      {% for star in five %}
                          {% if forloop.counter <= school.rating %}
                              <i class="icon star"></i>
                          {% endif %}
                      {% endfor %}
                    </span>
                    <span class="organization__info-rating-icon">
                      {% for star in school|rating_empty_stars %}
                          <i class="icon star"></i>
                      {% endfor %}
                    </span>
              </span>
              <p class="organization__info-rating-desc">
                {{ school.reviews.all|length }} отзывов
              </p>
            </div>
          </div>
          <div class="organization__info-right-part">
            <p class="organization__info-address">
              {{ school.school_offices.first.address }}
            </p>
          </div>
          <div class="organization__info-bottom-part">
            <div class="organization__info-list">
              <span class="organization__info-item">
                <i class="icon clock outline"></i>
                {{school.worktime}}
              </span>
              <span class="organization__info-item">
                {% for social in school.social_networks %}
                    <a href="https://{{ social.0 }}">{{ social.1 }}</a>
                    {% if forloop.counter < school.social_networks|length %}
                      ,
                    {% endif %}
                {% endfor %}
              </span>
            </div>
            <a class="organization__info-button">Записаться</a>
          </div>
        </div>
      </div>
      <div class="schoolLanding__content-headerMap">
          <div id="map1" style="width: 100%; height: 232px;"></div>        
      </div>
    </div>

    <div class="schoolLanding__content-category">
      <ul class="schoolLanding__content-category__list">
        <li class="schoolLanding__content-category__item active" id="all">
          <i class="icon list ul"></i>
          <p class="schoolLanding__content-category__item__title">Все</p>
        </li>
        {% for subject in school.school_subject_categories.all %}
        <li class="schoolLanding__content-category__item" id="{{ subject.id }}">
          <i class="icon book"></i>
          <p class="schoolLanding__content-category__item__title">{{ subject.title }}</p>
        </li>
        {% endfor %}
      </ul>
    </div>

    <div class="schoolLanding__content-services">
      <h3 class="schoolLanding__content-services__title">Курсы</h3>
      {% for course in school.school_subjects.all %}
      <section class="schoolLanding__content-services__item category{{ course.category.id }} categoryall">
        <div class="schoolLanding__content-services__item-left">
          <h2 class="schoolLanding__content-services__item-title">{{ course.title }}</h2>
          <span class="schoolLanding__content-services__item-time">{{ course.content }}</span>
        </div>
        <div class="schoolLanding__content-services__item-right">
          <span class="schoolLanding__content-services__item-price">{{ course.cost }} тенге</span>
          <span class="schoolLanding__content-services__item-icon">
            <i class="icon angle right"></i>
          </span>
        </div>
      </section>
      {% endfor %}
    </div>

    <div class="schoolLanding__content-teachers owl-carousel owl-theme">
      {% for teacher in all_teachers %}
      <div class="schoolLanding__content-teacher">
        <a href="{{ teacher.get_absolute_url }}">
          <div style="background: url({% if teacher.image %}{{teacher.image.url}}{% else %}{% static 'images/nophoto.png' %}{% endif %}) no-repeat;" class="schoolLanding__content-teacher__photo"></div>
          <div class="schoolLanding__content-teacher__name">{{teacher.first_name}}</div>
          <div class="schoolLanding__content-teacher__desc">Какое то описание учителя</div>
        </a>
      </div>
      {% endfor %}
    </div>

    <div class="schoolLanding__content-review">
      <div class="schoolLanding__content-review__left">
        <div class="schoolLanding__content-review-rate">
          <span class="schoolLanding__content-review-ratenum">{{ school.rating }}</span>
          <span class="schoolLanding__content-review-ratecount">{{ school.reviews.all|length }} оценок</span>
        </div>
        <div class="schoolLanding__content-review-ratestar">
          <div class="schoolLanding__content-review-ratestar__row">
            <span class="organization__info-rating-icon active">
              <i class="icon star"></i>
              <i class="icon star"></i>
              <i class="icon star"></i>
              <i class="icon star"></i>
              <i class="icon star"></i>
            </span>
            <div class="schoolLanding__content-review-ratestar__scale"></div>
            <span class="schoolLanding__content-review-ratestar__num">{{ school|get_ratings:5 }}</span>
          </div>
          <div class="schoolLanding__content-review-ratestar__row">
            <span class="organization__info-rating-icon active">
              <i class="icon star"></i>
              <i class="icon star"></i>
              <i class="icon star"></i>
              <i class="icon star"></i>
            </span>
            <span class="organization__info-rating-icon">
              <i class="icon star"></i>
            </span>
            <div class="schoolLanding__content-review-ratestar__scale"></div>
            <span class="schoolLanding__content-review-ratestar__num">{{ school|get_ratings:4 }}</span>
          </div>
          <div class="schoolLanding__content-review-ratestar__row">
            <span class="organization__info-rating-icon active">
              <i class="icon star"></i>
              <i class="icon star"></i>
              <i class="icon star"></i>
            </span>
            <span class="organization__info-rating-icon">
              <i class="icon star"></i>
              <i class="icon star"></i>
            </span>
            <div class="schoolLanding__content-review-ratestar__scale"></div>
            <span class="schoolLanding__content-review-ratestar__num">{{ school|get_ratings:3 }}</span>
          </div>
          <div class="schoolLanding__content-review-ratestar__row">
            <span class="organization__info-rating-icon active">
              <i class="icon star"></i>
              <i class="icon star"></i>
            </span>
            <span class="organization__info-rating-icon">
              <i class="icon star"></i>
              <i class="icon star"></i>
              <i class="icon star"></i>
            </span>
            <div class="schoolLanding__content-review-ratestar__scale"></div>
            <span class="schoolLanding__content-review-ratestar__num">{{ school|get_ratings:2 }}</span>
          </div>
          <div class="schoolLanding__content-review-ratestar__row">
            <span class="organization__info-rating-icon active">
              <i class="icon star"></i>
            </span>
            <span class="organization__info-rating-icon">
              <i class="icon star"></i>
              <i class="icon star"></i>
              <i class="icon star"></i>
              <i class="icon star"></i>
            </span>
            <div class="schoolLanding__content-review-ratestar__scale"></div>
            <span class="schoolLanding__content-review-ratestar__num">{{ school|get_ratings:1 }}</span>
          </div>
        </div>
      </div>
      <div class="schoolLanding__content-review__right">
        <div class="schoolLanding__content-review-comments__header">
          Отзывы {{ school.reviews.all|length }}
        </div>
        <div class="schoolLanding__content-review-comment">
          {% for review in school.reviews.all %}
          <div class="schoolLanding__content-review-comment__rating">
            <span class="organization__info-rating-icon active">
              {% for star in five %}
                  {% if forloop.counter <= review.rating %}
                      <i class="icon star"></i>
                  {% endif %}
              {% endfor %}
            </span>
            <span class="organization__info-rating-icon">
              {% for star in review|rating_empty_stars %}
                  <i class="icon star"></i>
              {% endfor %}
            </span>
          </div>
          <div class="schoolLanding__content-review-comment__text">
              {{review.text}}
          </div>
          <div class="schoolLanding__content-review-comment__about">
            <span class="schoolLanding__content-review-comment__about-left">
              <span class="schoolLanding__content-review-comment__about-name">{{review.author_profile.first_name}}</span>
              <span class="schoolLanding__content-review-comment__about-date">{{ review.timestamp }}</span>
            </span>
          </div>
          {% endfor %}
        </div>
        <div style="text-align: center;margin-top: 15px;margin-bottom: 50px;">
            <div class="ui pointing below label no_margin" style="font-size: 17px;">
              Оставьте отзыв:
            </div>
            <br><br>
            <span class="organization__info-rating-icon result_rating" number="">
              <i class="icon star make_review" id="star1" number="1"></i>
              <i class="icon star make_review" id="star2" number="2"></i>
              <i class="icon star make_review" id="star3" number="3"></i>
              <i class="icon star make_review" id="star4" number="4"></i>
              <i class="icon star make_review" id="star5" number="5"></i>
            </span>
            <form class="ui form wright_review" style="width: 80%;margin: auto;margin-top: 15px;display: none;">
              <textarea class="review_text" placeholder="Напишите отзыв" style="height: 80px;"></textarea>
              <div style="text-align: center;">
                <input class="ui button green save_review" url="{{school.save_review_url}}" value="Отправить" type="submit" onclick="return false">                
              </div>
            </form>  
            <br><br>
            <div class="review_error highlight_red" style="display: none;">Сначала нужно войти в аккаунт или зарегестрироваться</div>        
        </div>
      </div>
    </div>
    <div class="ui segment">
        <div id="map" style="width: 80%; height: 300px;margin: 30px auto;"></div>      
    </div>
  </main>
  <script type="text/javascript">
    ymaps.ready(init);
    function init(){ 
        x = parseFloat('{{school.school_offices.first.latitude}}')
        y = parseFloat('{{school.school_offices.first.longtude}}')
        console.log(x, y)
        var myMap = new ymaps.Map("map", {
            center: [x, y],
            zoom: 10
        },{
            restrictMapArea: [
                [42.8, 76.02848],
                [44.25654, 77.92848]
            ]
        })
        firstCollection = new ymaps.GeoObjectCollection(null)
        firstCollection.add(new ymaps.Placemark([x, y], {id:'{{school.id}}'}, 
            {
                iconLayout: 'default#imageWithContent',
                iconImageHref: '{% static "images/pointer.png" %}',
                iconImageSize: [20, 30],
                iconImageOffset: [-10, -15],
                iconContentOffset: [15, 15],
            }
        ));
        myMap.geoObjects.add(firstCollection); 
        var myMap1 = new ymaps.Map("map1", {
            center: [x, y],
            zoom: 10
        },{
            restrictMapArea: [
                [42.8, 76.02848],
                [44.25654, 77.92848]
            ]
        })
        firstCollection1 = new ymaps.GeoObjectCollection(null)
        firstCollection1.add(new ymaps.Placemark([x, y], {id:'{{school.id}}'}, 
            {
                iconLayout: 'default#imageWithContent',
                iconImageHref: '{% static "images/pointer.png" %}',
                iconImageSize: [20, 30],
                iconImageOffset: [-10, -15],
                iconContentOffset: [15, 15],
            }
        ));
        myMap1.geoObjects.add(firstCollection1); 
    }
  </script>
  <style type="text/css">
    .ymaps-2-1-74-controls__control_toolbar {}

    .ymaps-2-1-74-controls__control {
        right: 10px !important;
        left: auto !important;
    }

    .ymaps-2-1-74-search {
        display: none;
    }

    .ymaps-2-1-74-traffic {
        display: none;
    }

    .ymaps-2-1-74-listbox__button {
        display: none;
    }

    .left_p {
        padding-left: 0 !important;
    }

    .filter {
        padding-right: 0 !important;
        width: 180px !important;
    }

    .filter2 {
        padding-right: 0 !important;
        width: 150px !important;
    }
</style>

{% endblock content %}