{% extends "base.html" %}
{% load crispy_forms_tags %}

{% block head_title %}
    Управление | {{ block.super }}
{% endblock head_title %}

{% block head_extra %}
    {{ form.media }}
{% endblock head_extra %}
{% load ttags %}
{% load ttttags %}
{% load staticfiles %}

{% block content %}
<div class='ui container pb150 pt15'>
    <div class="ui grid stackable">
        {% include 'left_menu.html' %}
        <div class="w85 wide column">
            {% include 'school/head.html' %}
            <div class="ui grid stackable no_margin">
                <div class="sixteen wide column pt0 pb10 pr5 pl0">
                    <div class="ui segment shadow_small mt0 mb0 text15 hint_place1 no_padding" side="bottom" style="height: 100%">
                        <div class="text15 mb5 textdg pt10 pl15 pr10 pb5">
                            <b class="mr30">Основная информация</b>
                        </div>              
                        <div class="backwhitelow pt5 pb10 pl15 pr15">
                            <div class="no_padding full-w">
                                <div class="textblue textbold text12">Город:</div>
                                <span style="display: inline-block;" class="school_cities mr5">
                                    {% if instance.cities.all|length == 0 %}
                                        <i class="textg">—</i>
                                    {% else %}
                                        {%for city in instance.cities.all%}
                                            {{ city.title }}{%if instance.cities.all|length > forloop.counter%}, {%endif%} 
                                        {%endfor%}
                                    {%endif%}
                                </span>
                                {% if is_director %}
                                <a class="text13" onclick="$('.school_cities_form').show()"><i class="icon pen square blue mr0"></i> Изменить</a>
                                <form class="ui form no_margin school_cities_form" style="width: 400px;display: none;">
                                    <div class="ui grid stackable mb0">
                                        <div class="sixteen wide column pl0 pb0">
                                            <div style="height: 30px;" class="textdg text13 suggest_city">Вводите города через запятую</div>
                                        </div>
                                        <div class="twelve wide column no_padding">
                                            <div contenteditable="true" suggest_url="{% url 'schools:search_city' %}" class="border1 pt5 school_cities_edit no_margin br5 pl10 pr10" style="height: 29px;" position="0">
                                                {%for city in instance.cities.all%}{{ city.title }}{%if instance.cities.all|length > forloop.counter%}, {%endif%}{%endfor%}
                                            </div>
                                        </div>
                                        <div class="four wide column pt0 pb0 pl5 pr5">
                                            <a status="cities" class="save_school_title ui button mini blue" id="{{ instance.id }}" url="{{ instance.change_title_url }}">Сохранить</a>
                                        </div>
                                    </div>
                                </form>
                                {% endif %}  
                            </div>
                        </div>
                        <div class="pt5 pb10 pl15 pr15">
                            <div class="full-w">
                                <div class="textblue textbold text12">Номер телефона:</div>
                                <span style="display: inline-block;" class="school_phones mr5">
                                    {% if instance.phones|length == 0 %}
                                        <i class="textg">—</i>
                                    {% else %}
                                        {%for phone in instance.phones%}
                                            {{ phone }}
                                            {%if instance.phones|length > forloop.counter%},{%endif%} 
                                        {%endfor%}
                                    {%endif%}
                                </span>
                                {% if is_director %}
                                <a class="text13" onclick="$('.school_phones_form').show()" ><i class="icon pen square blue mr0"></i> Изменить</a>
                                <form class="ui form no_margin school_phones_form" style="width: 400px;display: none;">
                                    <div class="ui grid stackable mb0">
                                        <div class="sixteen wide column pl0 pb0">
                                            <span class="textdg text13">Вводите номера через запятую</span>
                                        </div>
                                        <div class="twelve wide column no_padding">
                                            <textarea class="pt5 school_phones_edit no_margin" style="height: 29px; overflow: hidden;">{%for phone in instance.phones%}{{ phone }}{%if instance.phones|length > forloop.counter%},{%endif%}{%endfor%}</textarea>
                                        </div>
                                        <div class="four wide column pt0 pl5 pb0 pr0">
                                            <a status="phones" class="save_school_title ui button mini blue" id="{{ instance.id }}" url="{{ instance.change_title_url }}">Сохранить</a>
                                        </div>
                                    </div>
                                </form>
                                {% endif %}  
                            </div>  
                        </div>
                        <div class="backwhitelow pt5 pb10 pl15 pr15">
                            <div class="no_padding full-w">
                                <div class="textblue textbold text12">Полное описание:</div>
                                <span class="school_content mr5">
                                {% if instance.content|length == 0 %}
                                    <i class="textg">—</i>
                                {%else%}
                                    {{ instance.content }}
                                {%endif%}
                                </span> 
                                {% if is_director %}
                                <a class="text13" onclick="$('.school_content_form').show()" ><i class="icon pen square blue mr0"></i> Изменить</a>
                                <form class="ui form no_margin school_content_form" style="width: 800px; display: none;">
                                    <div class="ui grid no_margin stackable">
                                        <div class="twelve wide column no_padding">
                                            <textarea placeholder="Введите описание центра" class="school_content_edit no_margin" style="height: 70px;">{{ instance.content }}</textarea>
                                        </div>
                                        <div class="four wide column pl5 pb0 pr0 pt0">
                                            <a status="content" class="save_school_title ui button mini blue" id="{{ instance.id }}" url="{{ instance.change_title_url }}">Сохранить</a>      
                                        </div>
                                    </div>
                                </form>
                                {% endif %}
                            </div>
                        </div>
                        <div class="pt5 pb5 pl15 pr15">
                            <div class="no_padding full-w">
                                <div class="textblue textbold text12">Короткое описание:</div>                                
                                <span class="school_slogan mr5">
                                    {% if instance.slogan|length == 0 %}
                                        <i class="textg">—</i>
                                    {% else %}
                                        {{ instance.slogan }}
                                    {%endif%}
                                </span>
                                {% if is_director %}
                                <a class="text13" onclick="$('.school_slogan_form').show()"><i class="icon pen square blue mr0"></i> Изменить</a>
                                <form class="ui form no_margin school_slogan_form" style="width: 400px;display: none;">
                                    <div class="ui grid">
                                        <div class="twelve wide column no_padding_side">
                                            <textarea class="school_slogan_edit no_margin" style="margin-bottom: 0;">{{ instance.slogan }}</textarea>
                                        </div>
                                        <div class="four wide column">
                                            <a status="slogan" class="save_school_title ui button mini blue" id="{{ instance.id }}" url="{{ instance.change_title_url }}">Сохранить</a>
                                        </div>
                                    </div>
                                </form>
                                {% endif %} 
                            </div>
                        </div>
                    </div>
                </div>
<!--                 <div class="eight wide column pt0 pl5 pb10 pr0">
                    <div class="ui segment shadow_small full-h no_padding">
                        <div class="text15 mb5 pl15 pr10 pt10 pb5 textdg">
                            <b>Дополнительная информация</b>
                        </div>
                        <div class="backwhitelow pt5 pb10 pl15 pr15">
                            <div class="full-w">
                                <div class="textblue textbold text12">Время работы:</div>
                                <span style="display: inline-block;" class="school_worktime text15 mr5">
                                    {% if worktime1 == '' or worktime2 == '' %}
                                        По предварительной записи
                                    {% else %}
                                        {{ worktime1 }} - {{ worktime2 }}
                                    {% endif %}
                                </span>
                                {% if is_director %}
                                <a class="text13" onclick="$('.school_worktime_form').show()" style="float: right;"><i class="icon pen square blue mr0"></i> Изменить</a>
                                <form class="ui form no_margin school_worktime_form" style="display: none;">
                                    <div class="textdg text13 textbold mb5 mt5">
                                        *Если оставите поля пустыми, то будет сохраненo, как "<span class="textblue">По предварительной записи</span>"
                                    </div>
                                    <textarea style="width: 50px;" class="school_worktime_edit1 no_margin pl5 pr5 dinline">{{ worktime1 }}</textarea>
                                    <div class="dinline pl5 pr5 pt5">-</div>
                                    <textarea style="width: 50px;" class="school_worktime_edit2 no_margin pl5 pr5 dinline">{{ worktime2 }}</textarea>
                                    <div class="mt5">
                                        <a status="worktime" class="save_school_title ui button mini blue" id="{{ instance.id }}" url="{{ instance.change_title_url }}">Сохранить</a>
                                    </div>
                                </form>
                                {% endif %}
                            </div> 
                        </div>
                        <div class="pt5 pb10 pl15 pr15">
                            <div class="full-w">
                                <div class="textblue textbold text12">Сайт:</div>
                                <span class="school_site mr5">
                                    {% if instance.site|length == 0 %}
                                        <i class="textg">—</i>
                                    {% else %}
                                        {{ instance.site }}
                                    {%endif%}
                                </span>
                                {% if is_director %}
                                <a class="text13" onclick="$('.school_site_form').show()" style="float: right;"><i class="icon pen square blue mr0"></i> Изменить</a>
                                <form class="ui form no_margin school_site_form" style="width: 400px;display: none;">
                                    <div class="ui grid">
                                        <div class="twelve wide column no_padding_side">
                                            <textarea class="school_site_edit no_margin" style="margin-bottom: 0;">{{ instance.site }}</textarea>
                                        </div>
                                        <div class="four wide column">
                                            <a status="site" class="save_school_title ui button mini blue" id="{{ instance.id }}" url="{{ instance.change_title_url }}">Сохранить</a>
                                        </div>
                                    </div>
                                </form>
                                {% endif %} 
                            </div>  
                        </div>
                        <div class="backwhitelow pt5 pb10 pl15 pr15">
                            <div class="full-w">
                                <div class="textblue textbold text12">Социальные сети:</div>
                                <div class="dinline school_social_list">
                                    {% for social in social_networks %}
                                        <a class="textbold textblue ui button small pl5 pr5 pt5 pb5 white shadow_small mb5 mr10 social_object{{forloop.counter}}" onclick="$('.social_form{{forloop.counter}}').modal('show')" id="{{forloop.counter}}">
                                            <i class="icon mr0 {{ social.1 }}" style="color: blue;font-size: 13px;"></i>
                                            {{ social.1 }}
                                        </a>
                                        <div class="ui modal mini social_form{{ forloop.counter }}">
                                            <i class="close icon"></i>
                                            <div class="content">
                                                <form class="ui form">
                                                    <textarea id="social_link{{forloop.counter}}" placeholder="Введите ссылку">{{social.0}}</textarea>
                                                    <a class="ui button mini blue" onclick="create_social('{{instance.create_social_url}}', '{{forloop.counter}}')">Сохранить</a>
                                                    <a class="ui button mini red" onclick="delete_social('{{instance.delete_social_url}}', '{{forloop.counter}}')" style="float: right;">Удалить</a>
                                                </form>
                                                <div class="errorsocial{{forloop.counter}} highlight_red" style="display: none;">Эта социальная сеть уже записана</div>
                                            </div>
                                        </div>                        
                                    {% endfor %}
                                    <a class="text13" onclick="$('.social_form_new').modal('show')" style="float: right;"><i class="icon plus square blue mr0"></i> Добавить социальную сеть</a>
                                </div>
                                <div class="ui modal mini social_form_new">
                                    <i class="close icon"></i>
                                    <div class="content">
                                        <form class="ui form">
                                            <textarea id="social_link_new" placeholder="Введите ссылку">{{social.0}}</textarea>
                                            <a class="ui button mini white border1 shadow_small textblue textbold" onclick="create_social('{{instance.create_social_url}}', '_new')">Сохранить</a>
                                            <a class="ui button mini white border1 shadow_small" onclick="delete_social('{{instance.delete_social_url}}', '_new')" style="float: right;"><i class="icon trash red"></i> Удалить</a>
                                        </form>
                                        <div class="errorsocial_new highlight_red" style="display: none;">Эта социальная сеть уже записана</div>
                                    </div>
                                </div>
                            </div>  
                        </div>
                        <div class="pt10 pb15 pl15 pr15">
                            <div class="full-w">
                                <div class="textblue textbold text12">Фотографии</div>
                                <div class="dinline">
                                    <div class="dflex">
                                        {% for banner in instance.banners.all %}
                                            {% if banner.image_banner %}
                                            <div class="mr15 dflex" id="banner{{banner.id}}">
                                                <img class="mr15" src="{{ banner.image_banner.url }}" style="width: 50px;height: 50px;border-radius: 5px;">
                                                <a class="delete_school_banner" id="{{ banner.id }}" url="{{ banner.delete_school_banner }}"><b style="color: red;">×</b></a>
                                            </div>
                                            {% endif %}
                                        {% endfor %}
                                    </div>                            
                                </div>
                                <div class="dinline">
                                    <form method='POST' class="mb0" action='' enctype='multipart/form-data'>{% csrf_token %}
                                        <input type="file" name="school_banner" id="school_banner" class="postfile">
                                        <label class="file_post" for="school_banner">
                                            <a class="ui button mini white border1 shadow_small mr5 mt10"><i class="icon image blue"></i>Выбрать картинку</a>
                                        </label>
                                        <input type="submit" class="mt10 ui button mini white border1 shadow_small save_banner textblue textbold" name="" value="Добавить">
                                    </form>
                                </div>
                            </div>  
                        </div>
                    </div>
                </div>
 -->            </div>
<!--             <div class="ui segment hint_place3" side="top">
                <div class="text15 mb15 textdg">
                    <b class="mr5">Предметы школы</b>
                    {{instance.school_subject_categories.all|length}}
                </div>
                <div class="">
                    <div class="ui grid stackable school_subject_list no_margin">
                        {% for subject in instance.school_subject_categories.all %}
                        <div class="four wide column pl0 pt0 pb10">
                            <a class="full-w full-h ui labeled icon button border1 small white shadow_small textblue subject_object{{subject.id}}" onclick="$('#subject_form{{subject.id}}').modal('show')" id="{{subject.id}}" style="text-align: left;">
                                <i class="icon file alternate backrbb textw"></i>
                                <b>{{ subject.title }}</b> 
                                <br>
                                <span class="textdg text-center">{{ subject|get_subject_courses_len:instance }} курсов</span>
                            </a>
                            <div class="ui modal mini" id="subject_form{{ subject.id }}">
                                <i class="close icon"></i>
                                <div class="content">
                                    <form class="ui form">
                                        <div style="height: 20px;">
                                            <div class="hint_subject_title{{subject.id}}" style="display: none;"></div>
                                        </div>
                                        <textarea id="subject_title{{subject.id}}" class="object_textarea" status='subject'>{{subject.title}}</textarea>
                                        <a class="ui button mini white shadow_small border1 textblue textbold" onclick="create_subject('{{subject.create_url}}', '{{subject.id}}')">Сохранить</a>
                                        <a class="ui button mini white shadow_small border1" onclick="delete_subject('{{subject.delete_url}}', '{{subject.id}}')" style="float: right;">
                                            <i class="icon trash red"></i> Удалить
                                        </a>
                                    </form>
                                    <div class="errorsubject{{subject.id}} highlight_red" style="display: none;">Предмет с таким названием уже сущетсвует</div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>                    
                </div>
                <a class="ui button mini blue shadow_blue mt15" onclick="$('#subject_form_new').modal('show')">Добавить предмет</a>
                <div class="ui modal mini" id="subject_form_new">
                    <i class="close icon"></i>
                    <div class="content">
                        <form class="ui form">
                            <div style="height: 20px;">
                                <div class="hint_subject_title_new" style="display: none;"></div>
                            </div>
                            <textarea class="object_textarea need_clear" id="subject_title_new" status='subject' placeholder="Название"></textarea>
                            <div class="text-center">
                                <a class="ui button mini white border1 shadow_small textblue textbold" onclick="create_subject('/schools/api/subject_create_url/', '_new');clear_textareas()">Создать</a>
                            </div>
                        </form>
                        <div class="errorsubject_new highlight_red" style="display: none;">Предмет с таким названием уже сущетсвует</div>
                    </div>
                </div>
            </div>
 -->            <div class="ui segment">
                <div class="text14 textdg mb5">
                    <b class="mr5">Скидки школы</b>
                    <span>{{instance.discounts.all|length}}</span>
                </div>
                <div class="">
                    <div class="ui grid stackable no_margin school_discounts_list">
                        {% for discount in instance.discounts.all %}
                        <div class="twenty wide column pt0 pl0 pb10">
                            <a class="full-w full-h ui button labeled icon small white border1 shadow_small textblue discount_object{{discount.id}}" onclick="$('#discount_form{{discount.id}}').modal('show')" id="{{discount.id}}" style="text-align: left;">
                                <i class="icon percent backyellow textblue"></i>
                                {{ discount.title }}
                            </a>
                            <div class="ui modal mini" id="discount_form{{ discount.id }}">
                                <i class="close icon"></i>
                                <div class="content">
                                    <form class="ui form">
                                        <div style="height: 20px;">
                                            <div class="hint_discount_title{{discount.id}}" style="display: none;"></div>
                                        </div>
                                        <textarea id="discount_title{{discount.id}}" class="object_textarea" status='discount'>{{discount.title}}</textarea>
                                        <div class="ui grid no_margin stackable">
                                            <div class="eight wide column pl0 pt0 pb0 pr5">
                                                <input placeholder="{{discount.amount}}" type="number" class="discount_amount{{discount.id}}" value="{{discount.amount}}">
                                            </div>
                                            <div class="eight wide column no_padding">
                                                <select class="discount_type{{discount.id}}" style="height: 29px;">
                                                    {% if discount.discount_type == 'percent'%}
                                                    <option value="percent">Проценты</option>
                                                    <option value="tenge">Тенге</option>
                                                    {% else %}
                                                    <option value="tenge">Тенге</option>
                                                    <option value="percent">Проценты</option>
                                                    {% endif %}
                                                </select>
                                            </div>
                                        </div>
                                        <div class="mt10">
                                            <a class="ui button mini white border1 shadow_small textblue textbold" onclick="create_discount('{{discount.create_url}}', '{{discount.id}}')">Сохранить</a>
                                            <a class="ui button mini white border1 shadow_small" onclick="delete_discount('{{discount.delete_url}}', '{{discount.id}}')" style="float: right;">
                                                <i class="icon trash red"></i> Удалить
                                            </a>
                                        </div>
                                    </form>
                                    <div class="errordiscount{{discount.id}} highlight_red" style="display: none;">Скидка с таким названием уже сущетсвует</div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                <a class="ui button mini blue shadow_blue mt15 mb5" onclick="$('#discount_form_new').modal('show')">Добавить Скидку</a>
                <div class="ui modal mini" id="discount_form_new">
                    <i class="close icon"></i>
                    <div class="content">
                        <form class="ui form text-center">
                            <b>Добавить cкидку</b>
                            <textarea class="object_textarea need_clear mt10 mb10" id="discount_title_new" status='discounts' placeholder="Название"></textarea>
                            <div class="ui grid no_margin stackable">
                                <div class="eight wide column pl0 pt0 pr5 pb0">
                                    <input placeholder="Сумма" type="number" class="discount_amount_new">
                                </div>
                                <div class="eight wide column no_padding">
                                    <select class="discount_type_new" id="_new" style="height: 29px;">
                                        <option value="percent">Проценты</option>
                                        <option value="tenge">Тенге</option>
                                    </select>
                                </div>
                            </div>
                            <div class="text-center">
                                <a class="ui button mini white shadow_small border1 textblue textbold mt10" onclick="create_discount('/schools/api/discounts_create_url/', '_new');clear_textareas()">
                                    Создать
                                </a>                                
                            </div>
                        </form>
                        <div class="errordiscounts_new highlight_red" style="display: none;">Скидка с таким названием уже сущетсвует</div>
                    </div>
                </div>
            </div>            
            <div class="ui segment no_margin pl15" side="top">
                <div class="text14 textdg pb10">
                    <b>Кабинеты</b>
                    <span>{{instance.cabinets.all|length}}</span>
                </div>
                <div class="ui grid all_cabinets no_margin">
                    {% for cabinet in instance.cabinets.all %}
                    <div class="twenty wide column pt0 pb0 pl0 pr10 cab{{cabinet.id}} {% if forloop.counter == 1 %}cabinet_orig{%endif%}">
                        <a id="{{cabinet.id}}" class="cabinet_details full-w ui button small dark text-left shadow_dark pl10 pr10 br5 pt10 pb10 textw mr5 mb5">
                            <div class="textw redx delete_cabinet" url="{% url 'schools:delete_cabinet' %}" status="{%if is_moderator%}{{instance.id}}{%endif%}">✖</div>
                            <b class="cabinet_title textyellow text14">{{cabinet.title}}</b>
                            <div class="mt5 text12"><span class="cabinet_capacity">{{cabinet.capacity}}</span> чел.</div>
                        </a>
                    </div>
                    {% endfor %}                                    
                </div>
                <a class="ui button mini shadow_blue blue mt15 cabinet_details" id="-1">Добавить кабинет</a>
                <div class="ui modal small add_cabinet_modal">                
                    <i class="close icon"></i>
                    <div class="content">
                        <form class="ui form half-w" style="margin: 0 auto">
                            <div class="cabinet_title_head textblue text17 textbold text-center mb10">Новый кабинет</div>
                            <div class="mb10">
                                <div class="textdg text13 textbold">Название</div>
                                <textarea class="mb0 need_clear office_cabinet_create_title office_cabinet_create_title{{ office.id }}"></textarea>
                            </div>
                            <div class="mb10">
                                <div class="textdg text13 textbold">Вместимость</div>
                                <input type="number" class="office_cabinet_create_capacity">
                            </div>
                            <div class="text-center">
                                <a class="ui button small white shadow_small border1 textbold textblue mt10 save_office_cabinet" url="{% url 'schools:create_cabinet_url' %}">Сохранить</a>
                                <div style="display: none;" class="cabinet_loader ui active inline loader mini"></div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            {%if school_crnt.version == 'business'%}
            {% include 'school/voronka_chart.html' %}
            <div class="ui segment mb0">
                <div class="textdg textbold text15 mb10">Отчеты по менеджерам</div>
                {% for manager in managers %}
                <a class="ui button small white shadow_small border1 mr10 mb10 get_manager_actions" 
                url="{% url 'schools:get_manager_actions' %}" id="{{manager.id}}">
                    {{manager.first_name}}
                </a>
                <div class="ui modal" style="margin-top: 10%;min-height: 100%;" id="manager_actions{{manager.id}}">
                    <i class="close icon"></i>
                    <div class="content">
                        <div class="set_manager_actions{{manager.id}}">
                        </div>
                    </div>
                </div>
                {% endfor %}
                {% if managers|length == 0 %}
                <div class="mt10">
                    <i class="textdg">Пока нет менеджеров</i>
                </div>
                {% endif %}
            </div>
            <div class="ui segment mb0">
                <div class="textdg textbold text15 mb10">Отчеты по учителям</div>
                {% for teacher in teachers %}
                <a class="ui button small white shadow_small border1 mr10 mb10 get_teacher_actions" 
                url="{% url 'schools:get_teacher_actions' %}" id="{{teacher.id}}">
                    {{teacher.first_name}}
                </a>
                <div class="ui modal" style="margin-top: 10%;min-height: 100%;" id="teacher_actions{{teacher.id}}">
                    <i class="close icon"></i>
                    <div class="content">
                        <div class="set_teacher_actions{{teacher.id}}">
                        </div>
                    </div>
                </div>
                {% endfor %}
                {% if teachers|length == 0 %}
                <div class="mt10">
                    <i class="textdg">Пока нет учителей</i>
                </div>
                {% endif %}
            </div>
            {% endif %}
        </div>
    </div>
</div>
<span class="day_id" group_id='{{ instance.id }}'></span>
<span class="check_moderator" style="display: none;" status="{%if is_moderator%}True{%else%}False{%endif%}"></span>
<span class="data" crnt_cabinet="-1" hint_type="0" last_hint="3" hint="{{hint}}" crm_option_url2="{%url 'schools:crm_option_url2'%}"></span>
<span style="display: none;" class="hint_place0" side="modal"></span>
{% include 'hints/info_hints.html' %}
{% include 'hints/get_hint_script.html' %}
<script type="text/javascript">
    function add_suggested_city(title){
        text = $('.school_cities_edit').text()
        position = window.getSelection().anchorOffset
        indexstart = position
        for (var i = position-1; i >= 0; i--) {
            indexstart = i;
            if (text[i] === ',') {
                break;
            }
            else if (text[i] === ' ') {
                break;
            }
        }
        newtext = text.slice(0, indexstart) + ' ' + title + text.slice(position)
        $('.school_cities_edit').text(newtext)
    }
    function clear_textareas(){
        $('.need_clear').val('')
    }
    function use_hint(id, name) {
        $(id).val(name);
    }
    $('.object_textarea').on('input', function(e) {
        id = $(this).attr('id')
        text = $(this).val()
        url = '/schools/api/search_url/'
        status = $(this).attr('status')
        if ($('.check_moderator').attr('status')=='True') {
            url = url + '?type=moderator&mod_school_id='+$('.day_id').attr('group_id')
        }
        $.ajax({
            url: url,
            data: {
                'text':text,
                'status':status,
            },
            dataType: 'json',
            success: function (data) {
                $('.hint_'+id).empty();
                if(data.res.length == 0){
                    $('.hint_'+id).hide()
                }
                else{
                    $('.hint_'+id).show()
                }
                for(var i = 0; i < data.res.length; i++){
                    name = data.res[i]
                    var element = $('<a class="ui button mini subject_hint" onclick="use_hint('+id+','+"'"+name+"'"+')">'+name+'</a>').appendTo('.hint_'+id);
                }
            }
        });
    });
    function create_subject(url, id) {
        title = $('#subject_title'+id).val()
        if (title != '') {
            if ($('.check_moderator').attr('status')=='True') {
                url = url + '?type=moderator&mod_school_id='+$('.day_id').attr('group_id')
            }
            $.ajax({
                url: url,
                data: {
                    'id':id,
                    'title':title,                
                },
                dataType: 'json',
                success: function (data) {
                    $('.errorsubject'+id).hide()
                    if (data.taken_name) {
                        $('.errorsubject'+id).show()
                    }
                    else{
                        if (id == '_new') {
                            $('<div class="twenty wide column pt0 pl0 pb10"><a class="ui button icon labeled full-w small white shadow_small subject_object'+data.idd+'" onclick="$('+"'#subject_form"+data.idd+"'"+').modal('+"'show'"+')"><i class="icon file alternate backrbb textw"></i>'+title+'</a></div> <div class="ui modal mini" id="subject_form'+data.idd+'"> <i class="close icon"></i> <div class="content"> <form class="ui form"> <textarea id="subject_title'+data.idd+'">'+title+'</textarea> <a class="ui button mini blue" onclick="create_subject('+"'"+data.create_url+"'"+','+"'"+data.idd+"'"+')">Сохранить</a> <a class="ui button mini red" onclick="delete_subject('+"'"+data.delete_url+"'"+','+"'"+data.idd+"'"+')" style="float: right;">Удалить</a> </form><div class="errorsubject'+data.idd+' highlight_red" style="display: none;">Предмет с таким названием уже сущетсвует</div></div> </div>').appendTo($('.school_subject_list'))
                        }
                        else{
                            $('.subject_object'+id).text(title);
                        }
                        $('#subject_form'+id).modal('hide')
                    }
                }
            })
        }
    };
    function delete_subject(url, id) {
        if ($('.check_moderator').attr('status')=='True') {
            url = url + '?type=moderator&mod_school_id='+$('.day_id').attr('group_id')
        }
        $.ajax({
            url: url,
            data: {
                'id':id
            },
            dataType: 'json',
            success: function (data) {
                $('.subject_object'+id).hide('fast');
                $('#subject_form'+id).modal('hide')
            }
        })        
    };
    function create_discount(url, id) {
        title = $('#discount_title'+id).val()
        type_id = '.discount_type'+id
        discount_type = $(type_id+' option:selected').val()
        amount = parseInt($('.discount_amount'+id).val())
        if (title != '' && (discount_type != 'percent' || (amount <= 100 && amount >= 0) )) {
            if ($('.check_moderator').attr('status')=='True') {
                url = url + '?type=moderator&mod_school_id='+$('.day_id').attr('group_id')
            }
            $.ajax({
                url: url,
                data: {
                    'id':id,
                    'title':title,                
                    'discount_type':discount_type,                
                    'amount':amount,                
                },
                dataType: 'json',
                success: function (data) {
                    $('.errordiscount'+id).hide()
                    if (data.taken_name) {
                        $('.errordiscount'+id).show()
                    }
                    else{
                        if (id == '_new') {
                            $('<div class="twenty wide column pt0 pl0 pb10"><a class="ui button labeled icon small white shadow_small discount_object'+data.idd+'" onclick="$('+"'#discount_form"+data.idd+"'"+').modal('+"'show'"+')"><i class="icon percent backyellow textw"></i>'+title+'</a></div> <div class="ui modal mini" id="discount_form'+data.idd+'"> <i class="close icon"></i> <div class="content"> <form class="ui form"> <textarea id="discount_title'+data.idd+'">'+title+'</textarea> <a class="ui button mini blue" onclick="create_discount('+"'"+data.create_url+"'"+','+"'"+data.idd+"'"+')">Сохранить</a> <a class="ui button mini red" onclick="delete_discount('+"'"+data.delete_url+"'"+','+"'"+data.idd+"'"+')" style="float: right;">Удалить</a> </form><div class="errordiscount'+data.idd+' highlight_red" style="display: none;">Предмет с таким названием уже сущетсвует</div></div> </div>').appendTo($('.school_discounts_list'))
                        }
                        else{
                            $('.discount_object'+id).text(title);
                        }
                        $('#discount_form'+id).modal('hide')
                    }
                }
            })
        }
    };
    function delete_discount(url, id) {
        if ($('.check_moderator').attr('status')=='True') {
            url = url + '?type=moderator&mod_school_id='+$('.day_id').attr('group_id')
        }
        $.ajax({
            url: url,
            data: {
                'id':id
            },
            dataType: 'json',
            success: function (data) {
                $('.discount_object'+id).hide('fast');
                $('#discount_form'+id).modal('hide')
            }
        })        
    };
    function create_office(url, id) {
        title = $('#office_title'+id).val()
        if (title != '') {
            if ($('.check_moderator').attr('status')=='True') {
                url = url + '?type=moderator&mod_school_id='+$('.day_id').attr('group_id')
            }
            $.ajax({
                url: url,
                data: {
                    'id':id,
                    'title':title,                
                },
                dataType: 'json',
                success: function (data) {
                    $('.erroroffice'+id).hide()
                    if (data.taken_name) {
                        $('.erroroffice'+id).show()
                    }
                    else{
                        if (id == '_new') {
                            $('<div class="twenty wide column pt0 pl0 pb10"><a class="ui button labeled icon small full-w white shadow_small office_object'+data.idd+'" onclick="$('+"'#office_form"+data.idd+"'"+').modal('+"'show'"+')"><i class="icon map marker alternate backlightblue textw"></i>'+title+'</a></div> <div class="ui modal mini" id="office_form'+data.idd+'"> <i class="close icon"></i> <div class="content"> <form class="ui form"> <textarea id="office_title'+data.idd+'">'+title+'</textarea> <a class="ui button mini blue" onclick="create_office('+"'"+data.create_url+"'"+','+"'"+data.idd+"'"+')">Сохранить</a> <a class="ui button mini red" onclick="delete_office('+"'"+data.delete_url+"'"+','+"'"+data.idd+"'"+')" style="float: right;">Удалить</a> </form><div class="erroroffice'+data.idd+' highlight_red" style="display: none;">Предмет с таким названием уже сущетсвует</div></div> </div>').appendTo($('.school_office_list'))
                        }
                        else{
                            $('.office_object'+id).text(title);
                        }
                        $('#office_form'+id).modal('hide')
                    }
                }
            })
        }
    };
    function delete_office(url, id) {
        if ($('.check_moderator').attr('status')=='True') {
            url = url + '?type=moderator&mod_school_id='+$('.day_id').attr('group_id')
        }
        $.ajax({
            url: url,
            data: {
                'id':id
            },
            dataType: 'json',
            success: function (data) {
                $('.office_object'+id).hide('fast');
                $('#office_form'+id).modal('hide')
            }
        })        
    };
    function create_social(url, id) {
        link = $('#social_link'+id).val()
        if (link != '') {
            if ($('.check_moderator').attr('status')=='True') {
                url = url + '?type=moderator&mod_school_id='+$('.day_id').attr('group_id')
            }
            $.ajax({
                url: url,
                data: {
                    'id':id,
                    'link':link,                
                },
                dataType: 'json',
                success: function (data) {
                    $('.errorsocial'+id).hide()
                    if (data.taken_name) {
                        $('.errorsocial'+id).show()
                    }
                    else{
                        if (id == '_new') {
                            $('<a class="ui button mini white shadow_small social_object'+id+'" onclick="$('+"'"+'#social_form'+id+"'"+').modal('+"'show'"+')" id="'+id+'">'+data.social_name+'</a> <div class="ui modal mini" id="social_form'+id+'"> <i class="close icon"></i> <div class="content"> <form class="ui form"> <textarea id="social_link'+id+'">'+link+'</textarea> <a class="ui button mini blue" onclick="create_social('+"'"+data.create_url+"'"+','+"'"+id+"'"+')">Сохранить</a> <a class="ui button mini red" onclick="delete_social('+"'"+data.delete_url+"'"+','+"'"+id+"'"+')" style="float: right;">Удалить</a> </form><div class="errorsocial'+id+' highlight_red" style="display: none;">Эта социальная сеть уже записана</div></div> </div>').appendTo($('.school_social_list'))
                        }
                        else{
                            $('.social_object'+id).text(data.social_name);
                        }
                        $('.social_form'+id).modal('hide')
                    }
                }
            })
        }
    };
    function delete_social(url, id) {
        if ($('.check_moderator').attr('status')=='True') {
            url = url + '?type=moderator&mod_school_id='+$('.day_id').attr('group_id')
        }
        $.ajax({
            url: url,
            data: {
                'id':id
            },
            dataType: 'json',
            success: function (data) {
                $('.social_object'+id).hide('fast');
                $('.social_form'+id).modal('hide')
            }
        })        
    };
</script>
{% endblock content %}