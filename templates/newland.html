{% extends "base.html" %}
{% load crispy_forms_tags %}
{% load staticfiles %}
{% load ttags %}
{% load ttttags %}
{% block content %}
<div  style="margin-top: -5px;color: #fff;">
    <div class="text-center newlandhead" style="">
        <div id="cloud-intro"></div>
        <div class="mb10 land_head">
            Введите название интересующего курса
        </div>
                <!-- <a class="ui button mini blue gojson">Go json</a> -->
        <form class="ui form mb0 search_form">
            <textarea class="map_search_input mb0" url="/api/map_search/" style="" placeholder="Учебные центры и курсы"></textarea>
            <a class="dinline ui button white mr0 map_search_btn rightbr5" url="/api/map_search_show/">
                <i class="icon search mr0" style="color: #232f3e;"></i>
            </a>
            <div class="full-w map_search_hint ui segment no_padding mt0" style="text-align: left;display: none;">
            </div>
        </form>
        <div class="mb0 mt10 land_amount">
            Более <b>{{len}}</b> учебных центров Алматы
        </div>
    </div>
    <div class="ui grid stackable deskpl30 deskpr30 pt10 pb50" style="background-color: #f5f5f5;">
        <div class="three wide column pb0 pr0 not_in_mobile">
            <div class="ui segment shadow no_padding all_caregories">
                <div class="ui segment mb0 textw backlightblue" style="line-height: 25px;border-radius:7px 7px 0px 0px;color: #232f3e;text-align: left;padding: 5px 15px;"><b>Категории:</b></div>
                {% for cat in categories %}
                <a href="{{cat.get_absolute_url}}" class="ui button full-w {%if forloop.counter|is_odd %}white{%else%}lightgrey{%endif%}" style="line-height: 25px;border-radius:{%if forloop.counter > 1%}0{%else%}7px 7px 0px 0{%endif%}px;color: #232f3e;text-align: left;padding: 5px 15px;border-bottom: 1px solid #e5e5e5">
                    <div style="font-size: 14;font-weight: 400;">{{cat.title}}</div>
                </a>
                {% endfor %}
            </div>
        </div>
        <div class="thirteen wide column pl0 pt0" style="text-align: left;color: #696969">
            <div class="ui grid stackable no_margin">
                <div class="sixteen wide column pl15 pb0 mobpt0 pr0" style="display: inline-block;">
                    <a class="full-w ui button small white shadow_small border1 pt10 pb10 mb15 in_mobile" onclick="$('.categories_modal').modal('show')">
                        <i class="icon list textblue"></i>
                        Категории
                    </a>
                </div>
                {% for school in schools %}
                    {% include 'modals/school_list.html' %}
                {% endfor %}
            </div>
        </div>
    </div>
    <div class="ui modal categories_modal">
        <i class="close icon" style="margin-right: -15px;margin-top: -15px;"></i>
        <div class="content">
            <div style="height: 20px;"></div>
            <div class="mobile_categories"></div>
        </div>
    </div>
    {% include 'footer.html' %}
</div>
<span class="catchmob"></span>
<script type="text/javascript">
    fill_mob_cats()
    function fill_mob_cats(){
        if ($('.catchmob').width() == 1) {
            $('.all_caregories').appendTo('.mobile_categories')
        }
    }
    $('.gojson').on('click',function(e) {
        $.ajax({
            url: '/',
            type: 'POST',
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify({ "type": "confirmation", "group_id": 169590398 }),
            dataType: 'text',
            success: function(result) {
            }
        });        
    })
    $('.map_search_input').on('input', function(e) {
        text = $('.map_search_input').val()
        url = $(this).attr('url')
        $.ajax({
            url: url,
            data: {
                'text': text,
            },
            dataType: 'json',
            success: function (data) {
                if(data.res.length == 0){
                    $('.map_search_hint').hide();
                }
                else{
                    $('.map_search_hint').empty();
                    url = $('.show_url').attr('url')
                    for(var i = 0; i < data.res.length; i++){
                        if (data.res[i][1] == 'category') {
                            icon = '<b style="font-size:11px;color:grey;"></b> '
                        }
                        else 
                            icon = '<b style="font-size:11px;color:grey;">центр: </b>'
                        var element = $('<a href="'+data.res[i][2]+'" class="map_hint_item">'+icon+'<b>'+data.res[i][0]+'</b></a>').appendTo('.map_search_hint');
                    }
                    $('.map_search_hint').show();
                }
            }
        });
    })
    $('.map_search_by_tags').on('click',function(e) {
        text = $('.map_search_input').val()
    })
    
</script>
{% endblock content %}